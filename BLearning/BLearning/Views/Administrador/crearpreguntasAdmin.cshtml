@using BLearning.Models.Negocio
@{
    Layout = "~/Views/Shared/_LayoutAdministrador.cshtml";
}
@model List<TipoPreguntaEntidad>

<!-- begin PAGE TITLE AREA -->
<!-- Use this section for each page's title and breadcrumb layout. In this example a date range picker is included within the breadcrumb. -->
<div class="row">
    <div class="col-lg-12">
        <div class="page-title">
            <h1>
                Prepare new Activity
            </h1>
            <ol class="breadcrumb">
                <li>
                    <i class="fa fa-book"></i>  <a href="../Administrador/verActividadesAdmin"> Activities</a>
                </li>
                <li class="active"> New Activity</li>
                <li class="pull-right">
                    <a href="#" onclick="history.back();" class="btn btn-red btn-square date-picker"><i class="fa fa-chevron-circle-left"><span> Back</span></i></a>
                </li>
            </ol>
        </div>
    </div>
    <!-- /.col-lg-12 -->
</div>

    <div class="row">
        <div class=" col-lg-12">
        <div class="portlet portlet-default">
            <div class="portlet-heading">
                <div class="portlet-title">
                    <h4><i class="fa fa-plus-square"></i> Create new activity</h4>
                </div>
                <div class="clearfix"></div>
            </div>

                <div class="portlet-body">
                    <!--begin cabecera actividad-->
                    <div id="camposActividad" class="row">
                        <input type="hidden" id="idAct" value="0" />
                        <div class=" col-lg-12">
                            <div class="col-sm-3">
                            <div class="form-group">
                                <a href="@Url.Action("verActividadesAdmin", "Administrador", new { @area =""})" class="btn btn-red btn-block">
                                    <i class="fa fa-times-circle"></i> &nbsp; Close form
                                        </a>
                            </div>
                        </div>
                            <div class=" col-md-9">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <div class="input-group ">
                                                <div class="input-group-btn">
                                                <button class="btn dropdown-toggle" data-toggle="dropdown">
                                                        Level
                                                        <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu pull-left">
                                                        @for (int i = 1; i <= 8; i++)
                                                        {
                                                            <li class="liTxtDestreza" onclick=" nivelActivi(this)" title="@i">
                                                                <a onclick="return false;" href="#">@i</a>
                                                            </li>
                                                        }
                                                    </ul>
                                                </div>
                                                <input class="form-control" type="text" style="text-align: justify; background-color: #fff" disabled value="1" id="txtNivel">
                                            </div>
                                        </div>
                                    </div>
                                    <div class=" col-md-9">
                                        <div class=" form-group">
                                            <div class=" input-group">
                                                <div class="input-group-btn">
                                                <button class="btn" onclick="return false;">
                                                    Theme
                                                    </button>
                                                </div>
                                                <input type="text" id="temaAct" class="form-control" required="">
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>

                        </div>
                    </div>
                    <!--end cabecera actividad-->
                    <div class="row">
                        <div class=" col-lg-12">
                            <div class="col-sm-3">
                                <ul id="myStacked" class="nav nav-pills nav-stacked">
                                    <li class="active liBryan" id="pregunta1">
                                        <a href="#tab-pane1" onclick="currentQue(this)" data-mynumber="1" data-toggle="tab">Question 1</a>
                                    </li>
                                <li class="liBryan">
                                    <a onclick="nuevaPregunta(); return false;" class="btn"><i class="fa fa-plus-circle"></i> Add question</a>
                                            </li>
                                        </ul>
                            </div>
                            <div class="col-sm-9">
                                <div id="myStackedContent" class="tab-content">
                                    <div class="tab-pane fade in active" id="tab-pane1">
                                        <!--begin cabecera pregunta-->
                                        <form id="formPregCabe1">
                                            <div class="row">
                                                <div class="col-md-5">
                                                    <div class="form-group">
                                                        <div class="input-group ">
                                                            <div class="input-group-btn">
                                                                <button class="btn dropdown-toggle btn-bleBry" data-toggle="dropdown">
                                                                    Skill
                                                                    <span class="caret"></span>
                                                                </button>
                                                                <ul class="dropdown-menu pull-left">
                                                                    <li class="liTxtDestreza" onclick=" destrezaSltd(this)" title="Listening">
                                                                        <a onclick="return false;" href="#">Listening</a>
                                                                    </li>
                                                                    <li class="liTxtDestreza" onclick=" destrezaSltd(this)" title="Reading">
                                                                        <a onclick="return false;" href="#">Reading</a>
                                                                    </li>
                                                                    <li class="liTxtDestreza" onclick=" destrezaSltd(this)" title="Grammar/Vocabulary">
                                                                        <a onclick="return false;" href="#">Grammar/Vocabulary</a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                            <input class="form-control" type="text" style="text-align: justify; background-color: #fff" disabled value="Listening" id="txtDestreza" required="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class=" col-md-5">
                                                    <div class="form-group ">
                                                        <div class="input-group ">
                                                            <div class="input-group-btn">
                                                            <button class="btn" onclick="return false;">
                                                                    Duration
                                                                </button>
                                                            </div>
                                                            <input class="form-control cabeControl" type="number" min="1" step="1" style="text-align: justify; background-color: #fff" onchange="controlValor()" placeholder=" 0 Min" id="txtDuracion" required="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                <div class="form-group">
                                                    <button type="button" onclick="modalApoyo(); return false;" class="btn btn-default btn-block" >
                                                        <i class="fa fa-cog" ></i> Backing
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-5">
                                                    <div class=" form-group">
                                                        <div class="input-group">
                                                            <div class="input-group-btn">
                                                            <button class="btn" onclick="return false;">
                                                                    Score
                                                                </button>
                                                            </div>
                                                            <input class="form-control cabeControl" type="number" onchange="controlPonderacion()" style="text-align: left" placeholder="0" step="1" min="1" max="100" id="txtPonderacion" required="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-7">
                                                    <div class="form-group">
                                                        <div class="input-group ">
                                                            <div class="input-group-btn">
                                                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                                                                Model
                                                                    <span class="caret"></span>
                                                                </button>
                                                                <script>var arrayTiposPregunta = [];</script>
                                                                <ul class="dropdown-menu pull-left">
                                                                    @foreach (var item in Model)
                                                                    {
                                                                        <li onclick="obtenerTipoPregunta(this)" class="liTipoPreg" data-idpregu="@item.idTipo" id="@item.idTipo" title="@item.tipo">
                                                                            <a href="" onclick="return false;">@item.tipo</a>
                                                                            <script>
                                                                                var objTP = { "idTipo": '@item.idTipo', "tipo": '@item.tipo' };
                                                                                arrayTiposPregunta.push(objTP);
                                                                            </script>
                                                                        </li>

                                                                    }

                                                                </ul>
                                                            </div>
                                                            <input class="form-control" type="text" style="text-align:justify; background-color:#fff" disabled value="Completar" title="1" id="txtTipoPreg" required="">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <div class="form-group">
                                                        <div class="input-group">
                                                            <div class=" input-group-btn">
                                                            <button class=" btn" onclick="return false;">
                                                                    Instructions
                                                                </button>
                                                            </div>
                                                            <input class="form-control cabeControl" id="txtInstrucciones" type="text" required />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <!--end cabecera pregunta-->
                                        <!--begin cuerpo pregunta-->
                                        <form id="formPregCuer1"></form>
                                        <!--end cuerpo pregunta-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.portlet-body -->
            </div>
        </div>
    </div>



<!-- begin All modals containers-->
<div id="allModals"></div>
<div class="modal fade" data-backdrop="static" data-keyboard="false" id="modalGif" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:60%" role="document">
        <div id="contenedor">
            <div class="loader" id="loader">Loading...</div>
        </div>
    </div>
</div>
<!-- end All modals containers-->

<script>
    $(document).ajaxStart(function () {
        $("#modalGif").modal('show');
    });
    $(document).ajaxStop(function () {
        $("#modalGif").modal('hide');
        $('body').removeClass('modal-open');
        $('.modal-backdrop').remove();
    });

    var contadorPregunta = 1;
    var currentQ = 1;
    var currentTP = 1;
    var ponderacionTotal = 0;
    var apoyosDisponibles = new Array();

    function nuevaPregunta() {
        if (ponderacionSuma >= 100) {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'You can not create more questions. Qualification of 100 already achieved.',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
        }
        etiquetaPre = document.getElementById("pregunta" + contadorPregunta);
        panelPregunta = document.getElementById("tab-pane" + contadorPregunta);
        contadorPregunta++;
        etiquetaPre.insertAdjacentHTML("afterend", '<li class="liBryan" id="pregunta' + contadorPregunta + '"><a href="#tab-pane' + contadorPregunta + '" onclick="currentQue(this)" id="nP' + contadorPregunta + '" data-mynumber="' + contadorPregunta + '" data-toggle="tab">Question ' + contadorPregunta + '</a></li>');
        panelPregunta.insertAdjacentHTML("afterend", '<div class="tab-pane fade" id="tab-pane' + contadorPregunta + '">' + frmPrgCP() + '</div>');
        $("#nP" + contadorPregunta).click();
        document.getElementById("formPregCuer" + currentQ).insertAdjacentHTML("afterbegin", allTP[0]);
    }
    function currentQue(cQ) {
        currentQ = cQ.dataset.mynumber;
    }
    function destrezaSltd(dS) {
        var desSel = dS.title;
        $("#formPregCabe" + currentQ).find("#txtDestreza:input").val(desSel);
    }

    function nivelActivi(nivel) {
        var idNivel = nivel.title;
        $("#txtNivel:input").val(idNivel);
    }

    function obtenerTipoPregunta(tS) {
        var tipoSel = tS.title;
        currentTP = tS.id;
        $("#formPregCabe" + currentQ).find("#txtTipoPreg:input").val(tipoSel);
        $("#formPregCabe" + currentQ).find("#txtTipoPreg:input").attr("title", currentTP);
        $("#formPregCuer" + currentQ).find(".frmPreguntas").remove();
        document.getElementById("formPregCuer" + currentQ).insertAdjacentHTML("afterbegin", allTP[currentTP - 1]);
    }

    function guardarCamposActividad() {
        if ($("#idAct").val() == 0) {
            if ($("#temaAct").val() != "") {
                var _actividad = {
                    "descripcion": $("#temaAct").val(),
                    "idNivel": $("#txtNivel").val(),
                    "idPersona": $("#idPersonaAdmin").val()
                };
                $.ajax({
                    url: "../Administrador/guardarActividad",
                    type: 'POST',
                    data: JSON.stringify(_actividad),
                    dataType: 'json',
                    contentType: "application/json",
                    async: false,
                    success: function (data) {
                        $("#idAct").val(data);
                        $("#camposActividad").find('input, textarea, button, select').attr('disabled', 'disabled');
                    }
                });
            }
            else {
                Messenger.options = {
                    extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                    theme: 'flat'
                }
                Messenger().post({
                    message: 'You have not entered the subject of the activity',
                    type: 'error',
                    hideAfter: 3,
                    showCloseButton: false
                });
                return 0;
            }
        }
    }
    function destrezaApoyo() {
        var destreSelec = $("#formPregCabe" + currentQ).find("#txtDestreza").val();
        if (destreSelec == 'Listening') {
            if ($("#modalApoyo" + currentQ).length == 0) {
                alertaFaltaApoyo(1);
                return 0;
            }
            if (!($("#modalApoyo" + currentQ).find("#inputApoyolink").val() != "" || $("#modalApoyo" + currentQ).find("#inputApoyoAudio").val() != "")) {
                alertaFaltaApoyo(1);
                return 0;
            }
        }
        if (destreSelec == 'Reading') {
            if ($("#modalApoyo" + currentQ).length == 0) {
                alertaFaltaApoyo(2);
                return 0;
            }
            if ($("#modalApoyo" + currentQ).find("#inputApoyoTexto").val() == "") {
                alertaFaltaApoyo(2);
                return 0;
            }
        }
    }
    function alertaFaltaApoyo(num) {
        if (num == 1) {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'Listening questions should have an audio or video link backing',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
        }
        if (num == 2) {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'reading questions must have text backing',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
        }

    }
    function guardarPregunta() {
        var pass;
        $("#formPregCabe" + currentQ).find(".cabeControl").each(function () {
            if ($(this).val() == "") {
                alertaCampoVacio();
                $(this).css("border", "2px solid red").focus();
                pass = false;
                return false;
            }
            $(this).removeAttr("style");
        });
        if (pass != false) {
            if (destrezaApoyo() == 0) {
                return false;
            }
            var tP = $("#formPregCabe" + currentQ).find("#txtTipoPreg:input");
            self["obtener" + $("#formPregCabe" + currentQ).find("#txtTipoPreg:input").attr("title")]();

        }
    }
    function enviarPreguntaControlador(listasOcp, listasRes) {
        var _pregunta = new FormData();
        if (ponderacionSuma > 100) {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'Maximum score of the exceeded activity: (' + ponderacionSuma + '). Please correct',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
        }
        if ($("#modalApoyo" + currentQ).length > 0) {
            if ($("#modalApoyo" + currentQ).find("#queApoyo").val() != "0" && $("#modalApoyo" + currentQ).find("#queApoyo").val() != "-1") {
                _pregunta.append("modelApoyo.idApoyo", $("#modalApoyo" + currentQ).find("#queApoyo").val());
            }
            else {
                if (apoyoVacio() == 0) {
                    return false
                }
                _pregunta.append("modelApoyo.titulo", $("#modalApoyo" + currentQ).find("#inputApoyoTitulo").val());
                _pregunta.append("modelApoyo.enunciado", $("#modalApoyo" + currentQ).find("#inputApoyoTexto").val());
                _pregunta.append("modelApoyo.link", $("#modalApoyo" + currentQ).find("#inputApoyolink").val());
                _pregunta.append("modelApoyo.imagenImagen", $("#modalApoyo" + currentQ).find("#inputApoyoImg").prop('files')[0]);
                _pregunta.append("modelApoyo.audioAudio", $("#modalApoyo" + currentQ).find("#inputApoyoAudio").prop('files')[0]);
            }
        }
        if (guardarCamposActividad() == 0) {
            return false;
        }

        if ($("#formPregCabe" + currentQ).find("#txtTipoPreg").attr("title") == 4) {
            var literalImg = $("#formPregCuer" + currentQ).find("#literalesImg").children().last();
            var indice = parseInt(literalImg[0].id.substr(10));
            for (var i = 1; i <= indice; i++) {
                _pregunta.append("files", $("#formPregCuer" + currentQ).find("#inputImag" + i).prop('files')[0]);
            }
        }

        var ponderacion = $("#formPregCabe" + currentQ).find("#txtPonderacion").val().replace(".", ",");
        _pregunta.append("modelPregunta.destreza", $("#formPregCabe" + currentQ).find("#txtDestreza").val());
        _pregunta.append("modelPregunta.duracion", $("#formPregCabe" + currentQ).find("#txtDuracion").val());
        _pregunta.append("modelPregunta.ponderacion", ponderacion);
        _pregunta.append("modelPregunta.idTipo", $("#formPregCabe" + currentQ).find("#txtTipoPreg").attr("title"));
        _pregunta.append("modelPregunta.indicaciones", $("#formPregCabe" + currentQ).find("#txtInstrucciones").val());
        _pregunta.append("modelPregunta.idActividad", $("#idAct").val());
        for (var i = 0; i < listasOcp.length; i++) {
            _pregunta.append("modelListaOpciones", listasOcp[i]);
        }
        for (var i = 0; i < listasRes.length; i++) {
            _pregunta.append("modelListaRespuesta", listasRes[i]);
        }

        if ($("#formPregCabe" + currentQ).find("#txtTipoPreg").attr("title") == 4 || $("#formPregCabe" + currentQ).find("#txtTipoPreg").attr("title") == 1) {
            if ($("#formPregCuer" + currentQ).find("#mostrarOp").is(":checked")) {
                _pregunta.append("modelPregunta.mostarOpciones", $("#formPregCuer" + currentQ).find("#mostrarOp").is(":checked"));
            }
        }

        $.ajax({
            url: "../Administrador/guardarPregunta",
            type: 'POST',
            data: _pregunta,
            contentType: false,
            processData: false,
            success: function (data) {
                var objApoyos = { "idApoyo": data.idApo, "titulo": $("#modalApoyo" + currentQ).find("#inputApoyoTitulo").val() }
                apoyosDisponibles.push(objApoyos);
                bloquearPregunta();
                Messenger.options = {
                    extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                    theme: 'flat'
                }
                Messenger().post({
                    message: 'Question saved successfully',
                    type: 'success',
                    hideAfter: 3,
                    showCloseButton: false
                });
            }
        });
    }

    //funciones para la obtencion de las preguntas, segun su tipo
    //el numero representa el tipo de pregunta
    function obtener1() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass;
        $("#formPregCuer" + currentQ).find(".inpComp").each(function (i) {
            var oracion = $(this).val();
            if (oracion != "") {
                var pos1 = oracion.indexOf('"');
                var pos2 = oracion.lastIndexOf('"');
                if ((pos1 != -1 && pos1 != pos2) && pos1 + 1 != pos2) {
                    $(this).removeAttr('style');
                    var txtSacado = oracion.substring(pos1, pos2 + 1);
                    arrayRes[i] = txtSacado.substring(1, txtSacado.length - 1);
                    var texP1 = oracion.substring(0, pos1);
                    var texP2 = oracion.substring(pos2 + 1, oracion.length);
                    arrayOpc[i] = texP1 + '_' + texP2;
                }
                else {
                    pass = false;
                    $(this).css("border", "2px solid red").focus();
                    Messenger.options = {
                        extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                        theme: 'flat'
                    }
                    Messenger().post({
                        message: 'The words to complete must be enclosed in quotation marks " "',
                        type: 'error',
                        hideAfter: 3,
                        showCloseButton: false
                    });
                    return false
                }
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            //aqui retorno los array
            enviarPreguntaControlador(arrayOpc, arrayRes);
        }
    }
    function obtener2() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass;
        var pass2;
        $("#formPregCuer" + currentQ).find(".inputOrde").each(function (i) {
            if ($(this).val() != "") {
                $(this).removeAttr("style");
                arrayRes[i] = $(this).val();
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            $("#formPregCuer" + currentQ).find(".inputDesorde").each(function (i) {
                if ($(this).val() != "") {
                    $(this).removeAttr("style");
                    arrayOpc[i] = $(this).val();
                }
                else {
                    pass2 = false;
                    $(this).css("border", "2px solid red").focus();
                    alertaCampoVacio();
                    return false;
                }
            });
            if (pass2 != false) {
                //aqui retorno los array
                enviarPreguntaControlador(arrayOpc, arrayRes);
            }
        }
    }
    function obtener3() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass;
        var pass2;
        $("#formPregCuer" + currentQ).find(".inputTradu").each(function (i) {
            if ($(this).val() != "") {
                $(this).removeAttr("style");
                arrayRes[i] = $(this).val();
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            $("#formPregCuer" + currentQ).find(".inputOriginal").each(function (i) {
                if ($(this).val() != "") {
                    $(this).removeAttr("style");
                    arrayOpc[i] = $(this).val();
                }
                else {
                    pass2 = false;
                    $(this).css("border", "2px solid red").focus();
                    alertaCampoVacio();
                    return false;
                }
            });
            if (pass2 != false) {
                //aqui retorno los array
                enviarPreguntaControlador(arrayOpc, arrayRes);
            }
        }
    }
    function obtener4() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass;
        var pass2;

        $("#formPregCuer" + currentQ).find(".inputImgText").each(function (i) {
            if ($(this).val() != "") {
                $(this).removeAttr("style");
                arrayRes[i] = $(this).val();
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            $("#formPregCuer" + currentQ).find(".inputImg").each(function (i) {
                if ($(this).val() != "") {

                }
                else {
                    pass2 = false;
                    var cI = i + 1;
                    $("#formPregCuer" + currentQ).find("blah" + cI).css("border", "2px solid red");
                    Messenger.options = {
                        extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                        theme: 'flat'
                    }
                    Messenger().post({
                        message: 'You have not uploaded all the images',
                        type: 'error',
                        hideAfter: 3,
                        showCloseButton: false
                    });
                    return false;
                }
            });
            if (pass2 != false) {
                //aqui retorno los array
                enviarPreguntaControlador(arrayOpc, arrayRes);
            }
        }
    }
    function obtener5() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass;
        var pass2;
        $("#formPregCuer" + currentQ).find(".inputThead").each(function (i) {
            if ($(this).val() != "") {
                $(this).css("border", "1px solid #ccc");
                arrayOpc[i] = $(this).val();
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            $("#formPregCuer" + currentQ).find(".inputTbody").each(function (i) {
                if ($(this).val() != "") {
                    $(this).css("border", "1px solid #ccc");
                    arrayRes[i] = $(this).val();
                }
                else {
                    pass2 = false;
                    $(this).css("border", "2px solid red").focus();
                    alertaCampoVacio();
                    return false;
                }
            });
            if (pass2 != false) {
                //aqui retorno los array
                enviarPreguntaControlador(arrayOpc, arrayRes);
            }
        }
    }
    function obtener6() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass = false;
        var pass2;

        var checkIndice = 0;
        var checkActi = 0;
        var literalSel = $("#formPregCuer" + currentQ).find("#literalesSel").children().last();
        var indice = parseInt(literalSel[0].id.substr(10));
        var noCheck = indice;
        $("#formPregCuer" + currentQ).find(".inputSel").each(function (i) {
            if ($(this).val() != "") {
                $(this).removeAttr("style");
                arrayOpc[i] = $(this).val();
                var idCheck = i + 1;
                if ($("#formPregCuer" + currentQ).find("#check" + idCheck).is(":checked")) {
                    checkActi++;
                    if (checkActi == indice) {
                        pass = false;
                        Messenger.options = {
                            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                            theme: 'flat'
                        }
                        Messenger().post({
                            message: 'All options can not be marked as correct',
                            type: 'info',
                            hideAfter: 3,
                            showCloseButton: false
                        });
                        return false;
                    }
                    else {
                        arrayRes[checkIndice] = $(this).val();
                        checkIndice++;
                        pass = true;
                    }
                }
                else {
                    noCheck--;
                    if (noCheck == 0) {
                        pass = false;
                        Messenger.options = {
                            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                            theme: 'flat'
                        }
                        Messenger().post({
                            message: 'You must mark at least one option as correct',
                            type: 'info',
                            hideAfter: 3,
                            showCloseButton: false
                        });
                        return false;
                    }
                }
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            //aqui retorno los array
            enviarPreguntaControlador(arrayOpc, arrayRes);
        }
    }
    function obtener7() {
        var arrayOpc = new Array();
        var arrayRes = new Array();
        var pass;
        var pass2;
        $("#formPregCuer" + currentQ).find(".inputIzq").each(function (i) {
            if ($(this).val() != "") {
                $(this).removeAttr("style");
                arrayRes[i] = $(this).val();
            }
            else {
                pass = false;
                $(this).css("border", "2px solid red").focus();
                alertaCampoVacio();
                return false;
            }
        });
        if (pass != false) {
            $("#formPregCuer" + currentQ).find(".inputDer").each(function (i) {
                if ($(this).val() != "") {
                    $(this).removeAttr("style");
                    arrayOpc[i] = $(this).val();
                }
                else {
                    pass2 = false;
                    $(this).css("border", "2px solid red").focus();
                    alertaCampoVacio();
                    return false;
                }
            });
            if (pass2 != false) {
                //aqui retorno los array
                enviarPreguntaControlador(arrayOpc, arrayRes);
            }
        }
    }

    //funciones para añadir y quitar literales
    function sumarComplete() {
        var literalCom = $("#formPregCuer" + currentQ).find("#literalesCom").children().last();
        var indice = (parseInt(literalCom[0].id.substr(10))) + 1;
        var literalClon = '<div id="literalCom' + indice + '" class="col-md-6 form-group"><div class="divComp input-group ">'
            + '<span class="input-group-addon "><span class="fa fa-question " style="background-color: #DFF5F2"></span>'
            + ' / <span class="fa fa-edit " style="background-color: #DFF5F2"></span></span><input class="inpComp form-control" type="text" /></div></div>';
        $("#formPregCuer" + currentQ).find("#literalesCom").append(literalClon);
    }
    function restarComplete() {
        var literalCom = $("#formPregCuer" + currentQ).find("#literalesCom").children().last();
        var indice = literalCom[0].id.substr(10);
        if (indice == "1") {
            alertaUnLiteral();
            return false;
        }
        $("#formPregCuer" + currentQ).find("#literalCom" + indice).remove();
    }
    function sumarOrdenar() {
        var literalOrd = $("#formPregCuer" + currentQ).find("#literalesOrd").children().last();
        var indice = (parseInt(literalOrd[0].id.substr(10))) + 1;
        var literalClon = '<div id="literalOrd' + indice + '"><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon">'
            + '<span class="fa fa-question" style="background-color: #DFF5F2">'
            + '</span></span><input type="text" class="form-control inputDesorde" placeholder="Disordered sentence" /></div></div>'
            + '<div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-edit " style="background-color: #DFF5F2">'
            + '</span></span><input type="text" class="form-control inputOrde" placeholder="Ordered sentence" /></div></div></div>';
        $("#formPregCuer" + currentQ).find("#literalesOrd").append(literalClon);
    }
    function restarOrdenar() {
        var literalOrd = $("#formPregCuer" + currentQ).find("#literalesOrd").children().last();
        var indice = literalOrd[0].id.substr(10);
        if (indice == "1") {
            alertaUnLiteral();
            return false;
        }
        $("#formPregCuer" + currentQ).find("#literalOrd" + indice).remove();
    }
    function sumarTraducir() {
        var literalTra = $("#formPregCuer" + currentQ).find("#literalesTra").children().last();
        var indice = (parseInt(literalTra[0].id.substr(10))) + 1;
        var literalClon = '<div id="literalTra' + indice + '"><div class="col-md-6 form-group">'
            + '<div class="input-group"><span class="input-group-addon"><span class="fa fa-question " style="background-color: #DFF5F2">'
            + '</span></span><input type="text" class="form-control inputOriginal" placeholder="Original sentence" /></div></div>'
            + '<div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-edit" style="background-color: #DFF5F2">'
            + '</span></span><input type="text" class="form-control inputTradu" placeholder="Translation" /></div></div></div></div>';
        $("#formPregCuer" + currentQ).find("#literalesTra").append(literalClon);
    }
    function restarTraducir() {
        var literalOrd = $("#formPregCuer" + currentQ).find("#literalesTra").children().last();
        var indice = literalOrd[0].id.substr(10);
        if (indice == "1") {
            alertaUnLiteral();
            return false;
        }
        $("#formPregCuer" + currentQ).find("#literalTra" + indice).remove();
    }
    function sumarImagen() {
        var literalImg = $("#formPregCuer" + currentQ).find("#literalesImg").children().last();
        var indice = (parseInt(literalImg[0].id.substr(10))) + 1;
        var literalClon = '<div class="col-md-4" id="literalImg' + indice + '">'
            + '<input style="display:none" name="files" type="file" data-max="3072" class="inputImg" id="inputImag' + indice + '" accept="image/*" onchange="fileMaxSize(this);readUrl(this);" />'
            + '<div class="portlet portlet-green"><div class="portlet-body " style="text-align:center"><button type="button" class="tre" data-idimg="' + indice + '" onclick="cargarImg(this)">'
            + '<img id="blah' + indice + '" class="blah img-thumbnail" src="../img/subirImagen.png" /></button></div><div class="portlet-footer">'
            + '<input type="text" class="inputImgText form-control" placeholder="Enter Meaning" style="text-align: center"/></div></div></div>';
        $("#formPregCuer" + currentQ).find("#literalesImg").append(literalClon);
    }
    function restarImagen() {
        var literalImg = $("#formPregCuer" + currentQ).find("#literalesImg").children().last();
        var indice = literalImg[0].id.substr(10);
        if (indice == "1") {
            alertaUnLiteral();
            return false;
        }
        $("#formPregCuer" + currentQ).find("#literalImg" + indice).remove();
    }
    function sumarSel() {
        var literalSel = $("#formPregCuer" + currentQ).find("#literalesSel").children().last();
        var indice = (parseInt(literalSel[0].id.substr(10))) + 1;
        if (indice > 8) {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'Maximum 8 options',
                type: 'info',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
            return false;
        }
        var literalClon = '<div id="literalSel' + indice + '" class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon">'
            + '<input type="checkbox" id="check' + indice + '" class="inputSelChk" />'
            + '</span><input type="text" class="form-control inputSel" placeholder="Option ' + indice + '" /></div></div>'
        $("#formPregCuer" + currentQ).find("#literalesSel").append(literalClon);
    }
    function restarSel() {
        var literalImg = $("#formPregCuer" + currentQ).find("#literalesSel").children().last();
        var indice = literalImg[0].id.substr(10);
        if (indice == "4") {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'There must be at least 4 options',
                type: 'info',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
        }
        $("#formPregCuer" + currentQ).find("#literalSel" + indice).remove();
    }

    var imgLiteSltd;
    function cargarImg(elemento) {
        imgLiteSltd = elemento.dataset.idimg;
        var inputClick = $("#formPregCuer" + currentQ).find("#inputImag" + imgLiteSltd);
        if (inputClick.val() != "") {
            imgLiteralCon--;
        }
        inputClick.click();
    }
    var imgLiteralCon = 0;
    function readUrl(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $("#formPregCuer" + currentQ).find('#blah' + imgLiteSltd).attr('src', e.target.result).width(200).height(200);
            };
            imgLiteralCon++;
            reader.readAsDataURL(input.files[0]);
        }
    }
    function crearTablaDepen() {
        $("#formPregCuer" + currentQ).find("#tablaDependencia").children().remove();
        var tablaDependencia = $("#formPregCuer" + currentQ).find("#tablaDependencia");
        var fi = $("#formPregCuer" + currentQ).find("#filas").val();
        var col = $("#formPregCuer" + currentQ).find("#colum").val();
        var thead = document.createElement("THEAD");
        var tr = document.createElement("TR");
        for (var i = 0; i < col; i++) {
            var th = document.createElement("TH");
            var input = document.createElement("INPUT");
            input.className = 'inputThead form-control';
            input.placeholder = 'Cabecera';
            input.style.textAlign = 'center';
            th.appendChild(input);
            tr.appendChild(th);
        }
        thead.appendChild(tr);
        tablaDependencia.append(thead);
        var tbody = document.createElement("TBODY");
        for (var i = 0; i < fi - 1; i++) {
            var tr = document.createElement("TR");
            tbody.appendChild(tr);
            for (var j = 0; j < col; j++) {
                var td = document.createElement("TD");
                var input = document.createElement("INPUT");
                input.className = 'inputTbody form-control';
                input.placeholder = 'Contenido';
                input.style.textAlign = 'center';
                td.appendChild(input);
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }
        tablaDependencia.append(tbody);
    }
    function bloquearPregunta() {
        $("#formPregCabe" + currentQ).find('input, textarea, button, select').attr('disabled', 'disabled');
        $("#formPregCuer" + currentQ).find('input, textarea, button, select,a').attr('disabled', 'disabled');
    }
    function modalControls() {
        if ($("#modalApoyo" + currentQ).find("#checkApoyoTexto").is(":checked")) {
            $("#modalApoyo" + currentQ).find("#inputApoyoTexto").removeAttr("disabled").prop("required", true);
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoTexto").is(":not(:checked)")) {
            $("#modalApoyo" + currentQ).find("#inputApoyoTexto").prop("disabled", "true").removeAttr("style").css("resize", "none");
        }

        if ($("#modalApoyo" + currentQ).find("#checkApoyoImg").is(":checked")) {
            $("#modalApoyo" + currentQ).find("#inputApoyoImg").removeAttr("disabled").prop("required", true);
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoImg").is(":not(:checked)")) {
            $("#modalApoyo" + currentQ).find("#inputApoyoImg").prop("disabled", "true").removeAttr("style").css("resize", "none");
        }

        if ($("#modalApoyo" + currentQ).find("#checkApoyoLink").is(":checked")) {
            $("#modalApoyo" + currentQ).find("#inputApoyolink").removeAttr("disabled").prop("required", true);
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoLink").is(":not(:checked)")) {
            $("#modalApoyo" + currentQ).find("#inputApoyolink").prop("disabled", "true").removeAttr("style").css("resize", "none");
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoAudio").is(":checked")) {
            $("#modalApoyo" + currentQ).find("#inputApoyoAudio").removeAttr("disabled").prop("required", true);
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoAudio").is(":not(:checked)")) {
            $("#modalApoyo" + currentQ).find("#inputApoyoAudio").prop("disabled", "true").removeAttr("style").css("resize", "none");
        }
    }
    function apoyoVacio() {

        if (($("#modalApoyo" + currentQ).find("#checkApoyoTexto").is(":checked") || $("#modalApoyo" + currentQ).find("#checkApoyoImg").is(":checked") || $("#modalApoyo" + currentQ).find("#checkApoyoLink").is(":checked") || $("#modalApoyo" + currentQ).find("#checkApoyoAudio").is(":checked")) && $("#modalApoyo" + currentQ).find("#inputApoyoTitulo").val() == "") {
            alertaApoyoCampoVacio();
            return 0;
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoTexto").is(":checked") && $("#modalApoyo" + currentQ).find("#inputApoyoTexto").val() == "") {
            alertaApoyoCampoVacio();
            return 0;
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoImg").is(":checked") && $("#modalApoyo" + currentQ).find("#inputApoyoImg").val() == "") {
            alertaApoyoCampoVacio();
            return 0;
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoLink").is(":checked") && $("#modalApoyo" + currentQ).find("#inputApoyolink").val() == "") {
            alertaApoyoCampoVacio();
            return 0;
        }
        if ($("#modalApoyo" + currentQ).find("#checkApoyoAudio").is(":checked") && $("#modalApoyo" + currentQ).find("#inputApoyoAudio").val() == "") {
            alertaApoyoCampoVacio();
            return 0;
        }
    }
    function alertaCampoVacio() {
        Messenger.options = {
            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
            theme: 'flat'
        }
        Messenger().post({
            message: 'You can not continue. Empty field',
            type: 'error',
            hideAfter: 3,
            showCloseButton: false
        });
        return false;
    }
    function alertaUnLiteral() {
        Messenger.options = {
            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
            theme: 'flat'
        }
        Messenger().post({
            message: 'There must be at least one literal',
            type: 'info',
            hideAfter: 3,
            showCloseButton: false
        });
        return false;
    }
    function alertaApoyoCampoVacio() {
        Messenger.options = {
            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
            theme: 'flat'
        }
        Messenger().post({
            message: 'Empty field in backing of activity',
            type: 'error',
            hideAfter: 3,
            showCloseButton: false
        });
        return 0;
    }
    var ponderacionSuma = 0;
    function controlPonderacion() {
        var ponde = $("#formPregCabe" + currentQ).find("#txtPonderacion");
        if (ponde.val() == 0) {
            ponde.focus();
            ponde.css("border", "2px solid red").focus();
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'Invalid question value',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
        }
        ponderacionSuma = 0;
        for (var i = 1; i <= contadorPregunta; i++) {
            ponderacionSuma = ponderacionSuma + parseInt($("#formPregCabe" + i).find("#txtPonderacion").val());
        }
        if (ponderacionSuma > 100) {
            ponde.focus();
            ponde.css("border", "2px solid red").focus();
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'Maximum score of the exceeded activity: (' + ponderacionSuma + '). Please correct',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
        }
        ponde.removeAttr("style");
    }
    var duracionSuma = 0;
    function controlValor() {
        var duracion = $("#formPregCabe" + currentQ).find("#txtDuracion");
        if (duracion.val() == 0) {
            duracion.focus();
            duracion.css("border", "2px solid red").focus();
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'Duration of the question not valid',
                type: 'error',
                hideAfter: 3,
                showCloseButton: false
            });
            return false;
        }
        duracionSuma = 0;
        for (var i = 1; i <= contadorPregunta; i++) {
            duracionSuma = duracionSuma + parseInt($("#formPregCabe" + i).find("#txtDuracion").val());
        }
        duracion.removeAttr("style");
    }

    function frmPrgCP() {
        var formularioPregu = '<form id="formPregCabe' + contadorPregunta + '"><div class="row"><div class="col-md-5">'
           + '<div class="form-group "><div class="input-group "><div class="input-group-btn"><button class="btn dropdown-toggle " data-toggle="dropdown">Skill <span class="caret">'
           + '</span></button><ul class="dropdown-menu pull-left"><li class="liTxtDestreza" onclick=" destrezaSltd(this)" title="Listening"><a onclick="return false;" href="#">Listening</a></li>'
           + '<li class="liTxtDestreza" onclick=" destrezaSltd(this)" title="Reading"><a onclick="return false;" href="#">Reading</a></li><li class="liTxtDestreza" onclick=" destrezaSltd(this)" title="Grammar/Vocabulary">'
           + '<a onclick="return false;" href="#">Grammar/Vocabulary</a></li></ul></div><input class="form-control" type="text" style="text-align: justify; background-color: #fff" disabled value="Listening" id="txtDestreza" required="">'
           + '</div></div></div><div class=" col-md-5"><div class="form-group "><div class="input-group "><div class="input-group-btn">'
           + '<button class="btn" onclick="return false;">Duration</button></div><input class="form-control cabeControl" type="number" min="1" step="1" style="text-align: justify; background-color: #fff" onchange="controlValor()" placeholder="You have ' + duracionSuma + ' Mins" id="txtDuracion" required="">'
           + '</div></div></div><div class="col-md-2"><div class="form-group"><button type="button" onclick="modalApoyo();return false;" class="btn btn-dark-blue btn-block">'
           + '<i class="fa fa-cog"></i> Backing</button></div></div></div>'
           + '<div class="row"><div class="col-md-5"><div class=" form-group"><div class="input-group"><div class="input-group-btn">'
           + '<button class="btn btn-bleBry" onclick="return false;">Value</button></div><input class="form-control cabeControl" type="number" style="text-align: left" placeholder="You have  ' + ponderacionSuma + ' points" '
           + 'step="1" onchange="controlPonderacion()" min="1" max="100" id="txtPonderacion" required=""></div></div></div><div class="col-md-7"><div class="form-group"><div class="input-group ">'
           + '<div class="input-group-btn"><button class="btn dropdown-toggle" data-toggle="dropdown">Model <span class="caret"></span></button>'
           + '<ul class="dropdown-menu pull-left">    ' + liTiposPregunta() + '       </ul></div><input class="form-control" type="text" style="text-align:justify; background-color:#fff" disabled title="1" value="Completar" id="txtTipoPreg" required="">'
           + '</div></div></div></div><div class="row"><div class="col-sm-12"><div class="form-group"><div class="input-group"><div class=" input-group-btn">'
           + '<button class=" btn" onclick="return false;">Instructions</button></div><input class="form-control cabeControl" id="txtInstrucciones" type="text" required />'
           + '</div></div></div></div></form>'
           + '<form id="formPregCuer' + contadorPregunta + '"></form>';
        return formularioPregu;
    }

    function liTiposPregunta() {
        var liTags = "";
        for (var i = 0; i < arrayTiposPregunta.length; i++) {
            var eachLiTag = '<li onclick="obtenerTipoPregunta(this)" class="liTipoPreg" data-idpregu="' + arrayTiposPregunta[i].idTipo + '" id="'
                + arrayTiposPregunta[i].idTipo + '" title="' + arrayTiposPregunta[i].tipo + '"><a href="" onclick="return false;">' + arrayTiposPregunta[i].tipo + '</a></li>';
            liTags = liTags.concat(eachLiTag);
        }
        return liTags;
    }

    var tipoPregunta1 = '<div class="row frmPreguntas" ><div class="col-lg-12"><p class="text-muted small" style="font-size:113%"><em>'
         + '<strong>Tip: </strong></em>Type in quotation marks " " the words that are to be completed</p></div>'

         + '<div class="col-lg-12"><div class="checkbox" style="margin-top: 0px;"><label><input id="mostrarOp" type="checkbox"> Mostar opciones</label></div></div>'

         + '<div id="literalesCom"><div id="literalCom1" class="col-md-6 form-group">'
         + '<div class="divComp input-group "><span class="input-group-addon">'
         + '<span class="fa fa-question " style="background-color: #DFF5F2"></span> / '
         + '<span class="fa fa-edit " style="background-color: #DFF5F2"></span></span><input class="inpComp form-control" type="text" />'
         + '</div></div></div><div class="col-md-offset-5 col-md-4">'
         + '<div class="form-group"><div class="btn-group btn-group-justified"><a class="btn btn-blue" onclick=" sumarComplete()" role="button">Add literal</a>'
         + '<a class="btn btn-red"  onclick=" restarComplete()" role="button"> Remove literal</a></div></div>'
         + '</div><div class=" col-md-3"><a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span> &nbsp;Save</a></div></div>';

    var tipoPregunta2 = '<div class="row frmPreguntas"><div id="literalesOrd"><div id="literalOrd1">'
        + '<div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-question " style="background-color: #DFF5F2">'
        + '</span></span><input type="text" class="form-control inputDesorde" placeholder="Disordered sentence" /></div></div>'
        + '<div class="col-md-6 form-group">'
        + '<div class="input-group"><span class="input-group-addon"><span class="fa fa-edit ">'
        + '</span></span><input type="text" class="form-control inputOrde" placeholder="Ordered sentence" /></div></div></div></div>'
        + '<div class="col-md-offset-5 col-md-4"><div class="form-group"><div class="btn-group btn-group-justified"><a class="btn btn-blue" onclick="sumarOrdenar()" role="button">Add literal</a>'
        + '<a class="btn btn-red" onclick="restarOrdenar()" role="button">Remove literal</a></div></div></div>'
        + '<div class=" col-md-3"><a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span> &nbsp;Save</a></div></div>';

    var tipoPregunta3 = '<div class="row frmPreguntas"><div id="literalesTra"><div id="literalTra1"><div class="col-md-6 form-group">'
        + '<div class="input-group"><span class="input-group-addon"><span class="fa fa-question " style="background-color: #DFF5F2">'
        + '</span></span><input type="text" class="form-control inputOriginal" placeholder="Original sentence" /></div></div>'
        + '<div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-edit " style="background-color: #DFF5F2">'
        + '</span></span><input type="text" class="form-control inputTradu" placeholder="Translation" /></div></div></div></div>'
        + '<div class="col-sm-offset-5 col-sm-4"><div class="form-group"><div class="btn-group btn-group-justified"> <a class="btn btn-blue" onclick="sumarTraducir()" role="button">Add literal</a>'
        + '<a class="btn btn-red" onclick="restarTraducir()" role="button">Remove literal</a></div></div></div>'
        + '<div class=" col-sm-3"><a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span> &nbsp;Save</a></div></div>';

    var tipoPregunta4 = '<div class="row frmPreguntas">'

        + '<div class="col-lg-12"><div class="checkbox" style="margin-top: 0px;"><label><input id="mostrarOp" type="checkbox"> Mostar opciones</label></div></div>'

        + '<div  id="literalesImg"><div class="col-md-4" id="literalImg1">'
        + '<input style="display:none" name="files" type="file" data-max="3072" class="inputImg" id="inputImag1" accept="image/*" onchange="fileMaxSize(this);readUrl(this);" />'
        + '<div class="portlet portlet-green"><div class="portlet-body " style="text-align:center"><button type="button" class="tre" data-idimg="1" onclick="cargarImg(this)">'
        + '<img id="blah1" class="blah img-thumbnail" src="../img/subirImagen.png" /></button></div><div class="portlet-footer">'
        + '<input type="text" class="inputImgText form-control" placeholder="Enter Meaning" style="text-align: center; " /></div></div></div>'
        + '</div><div class="col-md-offset-5 col-md-4"><div class="form-group"><div class="btn-group btn-group-justified"><a class="btn btn-blue" onclick="sumarImagen()" role="button">Add literal</a>'
        + '<a class="btn btn-red" onclick="restarImagen()" role="button">Remove literal</a></div></div></div>'
        + '<div class=" col-md-3"><a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span>&nbsp; Save</a></div></div>';

    var tipoPregunta5 = '<div class="row frmPreguntas"><div class="col-lg-12"><div class="dataTables_length"><label>Columns:</label>'
        + '<select id="colum"><option>2</option><option>3</option><option>4</option><option>5</option></select><label>&nbsp;Rows:</label>'
        + '<select id="filas"><option>2</option><option>3</option><option>4</option><option>5</option></select>&nbsp;&nbsp;'
        + '<input type="button" class=" btn btn-success" onclick="crearTablaDepen()" value="Create table" /></div></div><div class="col-lg-12" style="margin-top:1%">'
        + '<div class="table-responsive"><table id="tablaDependencia" class="table table-striped table-bordered table-hover table-green"></table></div></div>'
        + '<div class="col-md-offset-9 col-md-3"><a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span>&nbsp; Save</a></div></div>';

    var tipoPregunta6 = '<div class="row frmPreguntas"><div class="col-lg-12"><p class="text-muted" style="font-size:113%"><em><strong>Tip:</strong></em>'
        + 'Enter the opinions and check the ones that are correct</p></div><div id="literalesSel">'
        + '<div id="literalSel1" class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><input type="checkbox" id="check1" class="inputSelChk" />'
        + '</span><input type="text" class="form-control inputSel" placeholder="Option 1" /></div></div><div id="literalSel2" class="col-md-6 form-group">'
        + '<div class="input-group "><span class="input-group-addon"><input type="checkbox" id="check2" class="inputSelChk" /></span><input type="text" class="form-control inputSel" placeholder="Option 2" />'
        + '</div></div><div id="literalSel3" class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><input type="checkbox" id="check3" class="inputSelChk" />'
        + '</span><input type="text" class="form-control inputSel" placeholder="Option 3" /></div></div><div id="literalSel4" class="col-md-6 form-group">'
        + '<div class="input-group"><span class="input-group-addon"><input type="checkbox" id="check4" class="inputSelChk" /></span><input type="text" class="form-control inputSel" placeholder="Option 4" />'
        + '</div></div></div><div class="col-md-offset-5 col-md-4"><div class="form-group"><div class=" btn-group btn-group-justified"><a class="btn btn-blue" onclick="sumarSel()" role="button">Add literal</a>'
        + '<a class="btn btn-red" onclick="restarSel()" role="button">Remove literal</a></div></div></div>'
        + '<div class=" col-md-3"><a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span> &nbsp;Save</a></div></div>';

    var tipoPregunta7 = '<div class="row frmPreguntas"><div><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon">'
        + '<span class="fa fa-question " style="background-color: #DFF5F2"></span></span><input type="text" class="form-control inputIzq" />'
        + '</div></div><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-edit " style="background-color: #DFF5F2">'
        + '</span></span><input type="text" class="form-control inputDer" /></div></div><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon">'
        + '<span class="fa fa-question " style="background-color: #DFF5F2"></span></span><input type="text" class="form-control inputIzq" /></div>'
        + '</div><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-edit" style="background-color: #DFF5F2">'
        + '</span></span><input type="text" class="form-control inputDer" /></div></div><div class="col-md-6 form-group"><div class="input-group">'
        + '<span class="input-group-addon"><span class="fa fa-question " style="background-color: #DFF5F2"></span></span>'
        + '<input type="text" class="form-control inputIzq" /></div></div><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon">'
        + '<span class="fa fa-edit" style="background-color: #DFF5F2"></span></span><input type="text" class="form-control inputDer" />'
        + '</div></div><div class="col-md-6 form-group"><div class="input-group"><span class="input-group-addon">'
        + '<span class="fa fa-question " style="background-color: #DFF5F2"></span></span><input type="text" class="form-control inputIzq" />'
        + '</div></div><div class="col-sm-6 form-group"><div class="input-group"><span class="input-group-addon"><span class="fa fa-edit " style="background-color: #DFF5F2">'
        + '</span></span><input type="text" class="form-control inputDer" /></div></div></div><div class="col-md-offset-9 col-md-3">'
        + '<a class="btn btn-success btn-block" onclick=" guardarPregunta()" role="button"><span class="fa fa-save"></span> &nbsp;Save</a></div></div>';
    var allTP = new Array();
    allTP.push(tipoPregunta1);
    allTP.push(tipoPregunta2);
    allTP.push(tipoPregunta3);
    allTP.push(tipoPregunta4);
    allTP.push(tipoPregunta5);
    allTP.push(tipoPregunta6);
    allTP.push(tipoPregunta7);
    document.getElementById("formPregCuer" + currentQ).insertAdjacentHTML("afterbegin", allTP[0]);

    function modalApoyo() {
        if ($("#modalApoyo" + currentQ).length > 0) {
            $("#modalApoyo" + currentQ).modal('show');
        }
        else {
            var modalClon = '<div class="modal fade" id="modalApoyo' + currentQ + '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">'
                + '<div class="modal-dialog" style="width:45%" role="document"><div class="modal-content"><div class="modal-header bg-darrk-blue-o">'
                + '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                + '<h4 class="modal-title">Backing:</h4'
                + '</div></div><div class="modal-body"><input id="queApoyo" type="hidden"/>'
                + '<form id="botonSeleccione"><div class="row"><div class=" col-lg-12"><div class="form-group">'
                + '<div class="row"><div class="col-sm-4"><button type="button" onclick="crearApoyo(); return false" class="btn btn-success btn-block">'
                + '<span class="fa fa-plus"></span>&nbspCreate new backing</button></div><div class="col-sm-4">'
                + '<button type="button" onclick="asignarApoyo(); return false" class="btn btn-blue btn-block"><span class="fa fa-refresh"></span>'
                + '&nbspReuse a backing</button></div><div class="col-sm-4"><button type="button" onclick="msgElimnarApoyo();return false" class="btn btn-default btn-block">'
                + '<span class="fa fa-trash-o"></span>&nbspDelete backing</button></div></div>'
                + '</div></div></div></form><hr style="margin-top: 0px"/>'
                + '<form id="formNuevoApoyo" method="post" enctype="multipart/form-data" style="display:none">'
                + '<div class="row"><div class=" col-lg-12"><div class="form-group"><div class="row"><label for="textInput" class="col-sm-1 control-label">Title: &nbsp;</label>'
                + '<div class="col-sm-11"><input type="text" class="form-control" id="inputApoyoTitulo"></div></div></div>'
                + '<div class="form-group"><div class="checkbox ">'
                + '<label><input type="checkbox" id="checkApoyoTexto" onclick="modalControls()" /> Text</label></div>'
                + '<textarea id="inputApoyoTexto" class="form-control" style="resize:none;height: 15%" disabled></textarea></div><div class="form-group">'
                + '<div class="checkbox "><label><input type="checkbox" id="checkApoyoImg" onclick="modalControls()" /> Image</label>'
                + '</div><input type="file" data-max="3072" accept="image/*" id="inputApoyoImg" class="form-control" disabled /></div><div class="form-group"><div class="checkbox ">'
                + '<label><input type="checkbox" id="checkApoyoLink" onclick="modalControls()"/> Insert video</label></div><input type="url" id="inputApoyolink" class="form-control" disabled />'
                + '</div>'

                + '<div class="form-group"><div class="checkbox ">'
                + '<label><input type="checkbox" id="checkApoyoAudio"  onclick="modalControls()"/> Insert audio</label></div><input type="file" data-max="3072" onchange="fileMaxSize(this);" accept="audio/*" id="inputApoyoAudio" class="form-control input-file" disabled />'
                + '</div>'

                + '</div></div></form>'
                + '<form id="formUsarApoyo" style="display: none;"><div class="row"><div class="col-lg-12"><div class="form-group">'
                + '<label class="col-sm-3 control-label">Choose backing: &nbsp;</label><div class="col-sm-9"><select onchange="apoyoSelect(this)" id="selectUsarApoyo" class="form-group"><option selected>Chosse</option></select></div>'
                + '</div></div></div></form>'
                + '</div></div></div></div>';
            $("#allModals").append(modalClon);
            $("#modalApoyo" + currentQ).modal('show');
        }

    }
    function msgElimnarApoyo() {
        Messenger.options = {
            extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
            theme: 'flat'
        }
        msg = Messenger().post({
            message: 'Are you sure?',
            actions: {
                delete: {
                    label: "Delete",
                    action: function () {
                        msg.hide();
                        vaciarApoyo();
                    }
                },

                cancel: {
                    action: function () {
                        msg.hide();
                        return false;
                    }
                }
            }
        });
    }
    function vaciarApoyo() {
        $("#modalApoyo" + currentQ).find("#checkApoyoTexto").prop('checked', false);
        $("#modalApoyo" + currentQ).find("#inputApoyoTexto").val("").prop("disabled", "disabled");

        $("#modalApoyo" + currentQ).find("#checkApoyoImg").prop('checked', false);
        $("#modalApoyo" + currentQ).find("#inputApoyoImg").val("").prop("disabled", "disabled");

        $("#modalApoyo" + currentQ).find("#checkApoyoLink").prop('checked', false);
        $("#modalApoyo" + currentQ).find("#inputApoyolink").val("").prop("disabled", "disabled");

        $("#modalApoyo" + currentQ).find("#checkApoyoAudio").prop('checked', false);
        $("#modalApoyo" + currentQ).find("#inputApoyoAudio").val("").prop("disabled", "disabled");
        $("#modalApoyo" + currentQ).find("#inputApoyoTitulo").val("")
        
    }

    function crearApoyo() {
        $("#modalApoyo" + currentQ).find("#formNuevoApoyo").css("display", "block");
        $("#modalApoyo" + currentQ).find("#formUsarApoyo").css("display", "none");
        $("#modalApoyo" + currentQ).find("#queApoyo").val("0");
    }
    function asignarApoyo() {
        $("#modalApoyo" + currentQ).find("#formUsarApoyo").css("display", "block");
        $("#modalApoyo" + currentQ).find("#formNuevoApoyo").css("display", "none");
        $("#modalApoyo" + currentQ).find("#queApoyo").val("-1");
        $("#modalApoyo" + currentQ).find("#selectUsarApoyo").html("");
        $("#modalApoyo" + currentQ).find("#selectUsarApoyo").append('<option value="0">Choose</option>');
        $.each(apoyosDisponibles, function (i, value) {
            $("#modalApoyo" + currentQ).find("#selectUsarApoyo").append('<option value="' + value.idApoyo + '">' + value.titulo + '</option>');
        });
    }
    function apoyoSelect(aaa) {
        var id = aaa;
        $("#modalApoyo" + currentQ).find("#queApoyo").val(id.value);
    }

    function fileMaxSize(file) {
        var sizeByte = file.files[0].size;
        var siezekiloByte = parseInt(sizeByte / 1024);
        if (siezekiloByte > $(file).data('max')) {
            Messenger.options = {
                extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                theme: 'flat'
            }
            Messenger().post({
                message: 'File size exceeds allowed limit (3Mb)',
                type: 'error',
                hideAfter: 4,
                showCloseButton: false
            });
            $(file).val('');
        }
    }




</script>